<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light only">
    <meta name="darkreader-lock">
    <title>PPMS Receiver Registration</title>
    <!-- Bootstrap CSS -->
    <link href="../css/bootstrap/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- PPMS Custom Styles -->
    <link rel="stylesheet" href="../css/ppms-styles/shared/variables.css">
    <link rel="stylesheet" href="../css/ppms-styles/shared/typography.css">
    <link rel="stylesheet" href="../css/ppms-styles/shared/safe-typography-enhancements.css">
    <link rel="stylesheet" href="../css/ppms-styles/shared/password-validation.css">
    <link rel="stylesheet" href="../css/ppms-styles/shared/components.css">
    <link rel="stylesheet" href="../css/ppms-styles/auth/register.css">
    <!-- Mobile Responsive Styles -->
    <link rel="stylesheet" href="../css/ppms-styles/shared/mobile-responsive.css">
    <!-- Favicon -->
    <link rel="icon" href="../assets/Icon Web.ico" type="image/x-icon">
</head>
<body class="receiver-auth-body">
    <div class="receiver-auth-container">
        <!-- Left Panel (Welcome) -->
        <div class="receiver-left-panel">
            <h2>Join Us!</h2>
            <p>Create your account to start tracking your parcels.</p>
            <img src="../assets/parcelsecure.gif" alt="Parcel security illustration" onerror="this.style.display='none'">
        </div>

        <!-- Right Panel (Form) -->
        <div class="receiver-right-panel">
            <!-- Sticky Header -->
            <div class="receiver-header-section">
                <h2>Receiver Registration</h2>
                <p class="receiver-welcome-text">Create your account to get started</p>
            </div>

            <!-- Scrollable Form Content -->
            <div class="receiver-form-content">
                <form method="post" action="../php/receiver-register.php" class="w-100">
                <!-- Full Name Field -->
                <div class="receiver-form-group">
                    <label for="receiver-name" class="receiver-form-label">Full Name</label>
                    <div class="position-relative">
                        <i class="fas fa-user receiver-input-icon"></i>
                        <input
                            type="text"
                            class="receiver-form-control"
                            id="receiver-name"
                            name="name"
                            placeholder="Enter your full name"
                            required
                            pattern="^[a-zA-Z\s@/.',-]{2,100}$"
                            title="Name must be 2-100 characters, letters and common symbols only"
                            maxlength="100"
                            minlength="2">
                    </div>
                </div>

                <!-- Matric Number Field -->
                <div class="receiver-form-group">
                    <label for="matricnumber" class="receiver-form-label">Matric Number</label>
                    <div class="position-relative">
                        <i class="fas fa-id-card receiver-input-icon"></i>
                        <input
                            type="text"
                            class="receiver-form-control"
                            id="matricnumber"
                            name="matricnumber"
                            placeholder="e.g., CI123456"
                            required
                            maxlength="8"
                            pattern="^[A-Z]{2}[0-9]{6}$"
                            title="Matric Number must be 2 letters followed by 6 digits (e.g., CI230010)">
                    </div>
                </div>

                <!-- Phone Number Field -->
                <div class="receiver-form-group">
                    <label for="phone" class="receiver-form-label">Phone Number</label>
                    <div class="position-relative">
                        <i class="fas fa-phone receiver-input-icon"></i>
                        <input
                            type="tel"
                            class="receiver-form-control"
                            id="phone"
                            name="phoneNumber"
                            placeholder="e.g., +60123456789 or 0123456789"
                            required
                            pattern="^(\+60|0)[1-9][0-9]{7,9}$"
                            title="Enter Malaysian phone number: +60xxxxxxxxx or 01xxxxxxxx"
                            maxlength="13">
                    </div>
                </div>

                <!-- Security Question Field -->
                <div class="receiver-form-group">
                    <label for="security_question" class="receiver-form-label">Security Question</label>
                    <div class="position-relative">
                        <i class="fas fa-shield-alt receiver-input-icon"></i>
                        <select
                            class="receiver-form-control"
                            id="security_question"
                            name="security_question"
                            required
                            style="padding-left: 2.8rem;">
                            <option value="">Select a security question...</option>
                            <option value="What is your mother's maiden name?">What is your mother's maiden name?</option>
                            <option value="What was the name of your first pet?">What was the name of your first pet?</option>
                            <option value="What city were you born in?">What city were you born in?</option>
                            <option value="What is your favorite movie?">What is your favorite movie?</option>
                            <option value="What was your childhood nickname?">What was your childhood nickname?</option>
                            <option value="What is the name of your favorite teacher?">What is the name of your favorite teacher?</option>
                        </select>
                    </div>
                </div>

                <!-- Security Answer Field -->
                <div class="receiver-form-group">
                    <label for="security_answer" class="receiver-form-label">Security Answer</label>
                    <div class="position-relative">
                        <i class="fas fa-key receiver-input-icon"></i>
                        <input
                            type="text"
                            class="receiver-form-control"
                            id="security_answer"
                            name="security_answer"
                            placeholder="Enter your answer (case-insensitive)"
                            required
                            minlength="2"
                            maxlength="100">
                    </div>
                    <small class="text-muted mt-1 d-block" style="color: #a0aec0 !important;">
                        <i class="fas fa-info-circle me-1"></i>
                        This will be used to recover your password if forgotten.
                    </small>
                </div>

                <!-- Password Field -->
                <div class="receiver-form-group">
                    <label for="receiver-password" class="receiver-form-label">Password</label>
                    <div class="password-field-container">
                        <i class="fas fa-lock receiver-input-icon"></i>
                        <input
                            type="password"
                            class="receiver-form-control"
                            id="receiver-password"
                            name="password"
                            placeholder="Create a strong password"
                            required
                            minlength="12"
                            title="Password must be at least 12 characters long with uppercase, lowercase, number and special character.">

                        <!-- Password Requirements Popup -->
                        <div class="password-requirements">
                        <small>Password must:
                        </small>
                        <ul class="password-checklist">
                            <li class="requirement" data-requirement="length">
                                <div class="requirement-icon invalid"></div>
                                Have at least 12 characters
                            </li>
                            <li class="requirement" data-requirement="uppercase">
                                <div class="requirement-icon invalid"></div>
                                Have at least one uppercase letter
                            </li>
                            <li class="requirement" data-requirement="lowercase">
                                <div class="requirement-icon invalid"></div>
                                Have at least one lowercase letter
                            </li>
                            <li class="requirement" data-requirement="number">
                                <div class="requirement-icon invalid"></div>
                                Have at least one number
                            </li>
                            <li class="requirement" data-requirement="special">
                                <div class="requirement-icon invalid"></div>
                                Have at least one special character
                            </li>
                        </ul>
                        <!-- Password Strength Meter -->
                        <div class="password-strength-meter">
                            <div class="strength-bar">
                                <div class="strength-fill" id="strengthFill"></div>
                            </div>
                            <small class="strength-text" id="strengthText">Enter password to see strength</small>
                        </div>
                        </div>
                    </div>
                </div>

                <!-- Confirm Password Field -->
                <div class="receiver-form-group">
                    <label for="receiver-confirm-password" class="receiver-form-label">Confirm Password</label>
                    <div class="password-field-container">
                        <i class="fas fa-lock receiver-input-icon"></i>
                        <input
                            type="password"
                            class="receiver-form-control"
                            id="receiver-confirm-password"
                            name="confirm_password"
                            placeholder="Confirm your password"
                            required>
                    </div>
                    <!-- Password Match Indicator -->
                    <div class="password-match-indicator"></div>
                </div>

                    <!-- Register Button -->
                    <button type="submit" class="receiver-btn-primary">
                        <i class="fas fa-user-plus me-2"></i>
                        Create Account
                    </button>
                </form>

                <!-- Additional Links -->
                <div class="receiver-auth-links">
                    <p>
                        Already have an account?
                        <a href="receiver-login.html">Login here</a>
                    </p>
                </div>

                <button onclick="window.location.href='landingpage.html'" class="receiver-btn-secondary">
                    <i class="fas fa-arrow-left me-2"></i>
                    Back to Landing Page
                </button>
            </div>
        </div>
    </div>


    <script src="../js/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Password Validation JS -->
    <script src="../js/password-validation.js"></script>
<script>
  // Check for the ?registered=1 parameter in the URL
  if (window.location.search.includes('registered=1')) {
    Swal.fire({
      toast: true,
      position: 'top-end',
      icon: 'success',
      title: 'Registration successful!',
      showConfirmButton: false,
      timer: 2500,
      timerProgressBar: true,
      background: '#f9fafb',
      color: '#234567',
      customClass: {
        popup: 'swal2-toast-custom'
      }
    });
    // Remove the parameter from the URL after showing the toast
    window.history.replaceState({}, document.title, window.location.pathname);
  }

  // Initialize password validation
  let passwordValidator;
  document.addEventListener('DOMContentLoaded', function() {
    passwordValidator = new PasswordValidator('receiver-password', 'receiver-confirm-password');
  });

  // Form validation
  document.querySelector('form').addEventListener('submit', function(e) {
    const matricNumber = document.getElementById('matricnumber').value;
    const phoneNumber = document.getElementById('phone').value;
    const password = document.getElementById('receiver-password').value;
    const securityQuestion = document.getElementById('security_question').value;
    const securityAnswer = document.getElementById('security_answer').value.trim();

    // Validate Matric number (2 letters + 6 digits)
    if (!/^[A-Z]{2}[0-9]{6}$/.test(matricNumber)) {
      e.preventDefault();
      Swal.fire({
        icon: 'error',
        title: 'Invalid Matric Number!',
        text: 'Matric Number must be 2 letters followed by 6 digits (e.g., CI230010).',
        confirmButtonText: 'OK'
      });
      return false;
    }

    // Validate Malaysian phone number
    if (!/^(\+60|0)[1-9][0-9]{7,9}$/.test(phoneNumber)) {
      e.preventDefault();
      Swal.fire({
        icon: 'error',
        title: 'Invalid Phone Number!',
        text: 'Please enter a valid Malaysian phone number (e.g., +60123456789 or 0123456789).',
        confirmButtonText: 'OK'
      });
      return false;
    }

    // Validate security question
    if (!securityQuestion) {
      e.preventDefault();
      Swal.fire({
        icon: 'error',
        title: 'Security Question Required!',
        text: 'Please select a security question for password recovery.',
        confirmButtonText: 'OK'
      });
      return false;
    }

    // Validate security answer
    if (securityAnswer.length < 2) {
      e.preventDefault();
      Swal.fire({
        icon: 'error',
        title: 'Security Answer Required!',
        text: 'Please provide an answer to your security question (at least 2 characters).',
        confirmButtonText: 'OK'
      });
      return false;
    }

    // Validate password length
    if (password.length < 8) {
      e.preventDefault();
      Swal.fire({
        icon: 'error',
        title: 'Password Too Short!',
        text: 'Password must be at least 8 characters long.',
        confirmButtonText: 'OK'
      });
      return false;
    }
  });

  // Real-time validation
  document.getElementById('receiver-name').addEventListener('input', function() {
    const name = this.value.trim();
    if (name.length >= 2 && name.length <= 100 && /^[a-zA-Z\s@/.',-]+$/.test(name)) {
      this.classList.remove('is-invalid');
      this.classList.add('is-valid');
    } else if (name.length > 0) {
      this.classList.remove('is-valid');
      this.classList.add('is-invalid');
    } else {
      this.classList.remove('is-valid', 'is-invalid');
    }
  });

  document.getElementById('matricnumber').addEventListener('input', function() {
    const matricNumber = this.value.toUpperCase();
    this.value = matricNumber; // Convert to uppercase as user types
    if (matricNumber.length === 8 && /^[A-Z]{2}[0-9]{6}$/.test(matricNumber)) {
      this.classList.remove('is-invalid');
      this.classList.add('is-valid');
    } else if (matricNumber.length > 0) {
      this.classList.remove('is-valid');
      this.classList.add('is-invalid');
    } else {
      this.classList.remove('is-valid', 'is-invalid');
    }
  });

  document.getElementById('phone').addEventListener('input', function() {
    const phoneNumber = this.value;
    if (/^(\+60|0)[1-9][0-9]{7,9}$/.test(phoneNumber)) {
      this.classList.remove('is-invalid');
      this.classList.add('is-valid');
    } else if (phoneNumber.length > 0) {
      this.classList.remove('is-valid');
      this.classList.add('is-invalid');
    } else {
      this.classList.remove('is-valid', 'is-invalid');
    }
  });

  // Form submission validation
  document.querySelector('form').addEventListener('submit', function(e) {
    if (passwordValidator && !passwordValidator.isValid()) {
      e.preventDefault();

      // Show error message
      Swal.fire({
        icon: 'error',
        title: 'Invalid Password',
        text: 'Please ensure your password meets all requirements and passwords match.',
        confirmButtonColor: '#667eea'
      });

      return false;
    }
  });
</script>
<style>
/* Optional: Custom style for the toast */
.swal2-toast-custom {
  font-family: 'Poppins', 'Inter', sans-serif;
  border-radius: 18px;
  box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
}
</style>
</body>
</html>